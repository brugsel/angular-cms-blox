"use strict";angular.module("angularCmsBlox",["ngResource","ngCookies","ngAnimate","satellizer","pascalprecht.translate","xeditable"]),angular.module("angularCmsBlox").run(["$templateCache",function(a){a.put("auth/buttons.template.html",'<ul class="auth-buttons nav navbar-nav navbar-right">\n    <li ng-hide="ctrl.isAuthenticated()"><a href="/#!{{ctrl.loginPath}}">{{\'auth.login\' | translate}}</a></li>\n    <li ng-show="ctrl.isAuthenticated()"><a ng-click="ctrl.logout()">{{\'auth.logout\' | translate}}</a></li>\n</ul>\n'),a.put("auth/login.template.html",'<div class="auth-login">\n\n  <div ng-hide="ctrl.isAuthenticated()">\n\n    <div class="container">\n      <h3 cms-text="auth.title"></h3>\n    </div>\n\n    <div class="container">\n      <a class="btn btn-block btn-social btn-google-plus" ng-click="ctrl.authenticate(\'google\')">\n        <i class="fa fa-google"></i> Google\n      </a>\n    </div>\n\n    <div class="container">\n      <div class="signup-or-separator">\n        <h6 class="text" cms-text="auth.or"></h6>\n        <hr>\n      </div>\n    </div>\n\n    <div class="container">\n      <form role="form">\n\n        <div class="form-group input-group">\n          <span class="input-group-addon" id="email-addon"><i class="fa fa-envelope addon"></i></span>\n          <input type="text" class="form-control" id="email" ng-model="ctrl.loginForm.email" aria-describedby="email-addon" placeholder="{{\'auth.email\' | translate}}">\n        </div>\n        <div class="form-group input-group">\n          <span class="input-group-addon" id="password-addon"><i class="fa fa-lock addon"></i></span>\n          <input type="password" class="form-control" id="pwd" ng-model="ctrl.loginForm.password" aria-describedby="password-addon" placeholder="{{\'auth.password\' | translate}}">\n        </div>\n        <div ng-hide="ctrl.isLogin">\n          <div class="form-group input-group animate">\n            <span class="input-group-addon" id="password-check-addon"><i class="fa fa-lock addon"></i></span>\n            <input type="password" class="form-control" id="pwd-check" ng-model="ctrl.loginForm.passwordCheck" aria-describedby="password-check-addon" placeholder="{{\'auth.password-confirm\' | translate}}">\n          </div>\n        </div>\n      </form>\n        <a ng-show="ctrl.isLogin" class="btn btn-block btn-primary" ng-click="ctrl.login()" cms-text="auth.login"></a>\n        <a ng-hide="ctrl.isLogin" class="btn btn-block btn-primary" ng-click="ctrl.signup()" cms-text="auth.signup"></a>\n      <div class="row">\n        <div class="col-md-6">\n          <a class="pull-left" ng-click="ctrl.switch()" cms-text="auth.signup"></a>\n        </div>\n        <div class="col-md-6">\n          <a class="pull-right" onclick="alert(\'Not implemented yet!\')" cms-text="auth.lost"></a>\n        </div>\n      </div>\n\n    </div>\n  </div>\n\n  <div ng-show="ctrl.isAuthenticated()">\n    <h3>Logout</h3>\n\n    <div class="container">\n      <a class="btn btn-block btn-primary" ng-click="ctrl.logout()">\n        Logout\n      </a>\n      <a class="btn btn-block btn-default" ng-click="ctrl.cancel()">\n        Cancel\n      </a>\n    </div>\n\n  </div>\n\n</div>\n'),a.put("cms/cms-control-panel.template.html",'<div class="cms-control-panel" ng-show="ctrl.isAuthenticated()">\n\n    <div class="panel-button pull-right"><i class="fa fa-2x fa-cog" ng-click="ctrl.showPanel()"></i></div>\n\n    <div class="panel-widget" ng-show="ctrl.panel">\n        <i class="fa fa-2x fa-save" ng-click="ctrl.save()" ng-hide="saved"></i>\n        <i class="fa fa-2x fa-ellipsis-h" ng-show="saved"></i>\n        <i class="fa fa-2x fa-undo" ng-click="ctrl.undo()"></i>\n    </div>\n\n</div>\n'),a.put("cms/cms-text.template.html",'<span translate-cloak editable-textarea="text" onaftersave="ctrl.save()" e-form="textBtnForm" e-rows="{{rows}}" e-cols="{{cols}}">\n  {{text}} <i class="fa fa-edit" ng-if="ctrl.isAuthenticated()" class="btn btn-sm" ng-click="textBtnForm.$show()" ng-hide="textBtnForm.$visible"></i>\n</span>\n')}]),angular.module("angularCmsBlox").directive("authButtons",[function(){return{restrict:"EA",replace:!0,scope:{},templateUrl:"auth/buttons.template.html",controller:["authService","cmsConfig",function(a,b){this.isAuthenticated=function(){return a.isAuthenticated()},this.logout=function(){a.logout()},this.loginPath=b.loginPath}],controllerAs:"ctrl",bindToController:!0}}]),angular.module("angularCmsBlox").config([function(){}]),angular.module("angularCmsBlox").factory("authService",["$resource","$auth","cmsConfig",function(a,b,c){var d,e,f=a(c.profileUrl),g=function(a,b){f.get(function(c){d=c,b(d.role>=a?!0:!1)})},h=function(){return b.isAuthenticated()},i=function(){b.logout()};return{isAuthorized:g,isAuthenticated:h,logout:i,getPath:function(){return e},setPath:function(a){e=a}}}]),angular.module("angularCmsBlox").constant("ACCESS_LEVELS",{pub:1,user:2,aso:4,dooner:8,root:16}).config(function(a){var b=function(a,b){return{response:function(a){return a},responseError:function(c){switch(c.status){case 401:b.$broadcast("auth:loginRequired");break;case 403:b.$broadcast("auth:forbidden");break;case 404:b.$broadcast("page:notFound");break;case 500:b.$broadcast("server:error")}return a.reject(c)}}};a.interceptors.push(b)}).run(["$rootScope","$location","authService","ACCESS_LEVELS",function(a,b,c,d){a.$on("$stateChangeStart",function(a,e){e.accessLevel>d.pub&&(c.isAuthenticated()?c.isAuthorized(e.accessLevel,function(a){a||b.path("/")}):(c.setPath(b.path()),b.path("/login")))}),a.$on("auth:loginRequired",function(){c.setPath(b.path()),b.path("/login")})}]),angular.module("angularCmsBlox").directive("authLogin",["$location","authService",function(a,b){return{restrict:"EA",replace:!0,scope:{},templateUrl:"auth/login.template.html",controller:["$auth",function(c){this.loginForm={},this.isLogin=!0,this.authenticate=function(d){c.authenticate(d).then(function(){b.getPath()&&a.path(b.getPath())})},this.isAuthenticated=function(){return c.isAuthenticated()},this.login=function(){c.login({email:this.loginForm.email,password:this.loginForm.password})},this.logout=function(){c.logout()},this.signup=function(){c.signup({email:this.loginForm.email,password:this.loginForm.password}).then(function(a){console.log(a.data)})},this.cancel=function(){a.path(b.getPath()?b.getPath():"/")},this["switch"]=function(){this.isLogin=this.isLogin?!1:!0}}],controllerAs:"ctrl",bindToController:!0}}]),angular.module("angularCmsBlox").directive("cmsControlPanel",[function(){return{restrict:"EA",replace:!1,scope:{},templateUrl:"cms/cms-control-panel.template.html",controller:"cmsControlPanelController",controllerAs:"ctrl",bindToController:!0}}]).controller("cmsControlPanelController",["$scope","cmsService","authService","$timeout",function(a,b,c,d){this.panel=!1,this.showPanel=function(){this.panel=!this.panel},this.isAuthenticated=function(){return c.isAuthenticated()},this.undo=function(){b.undoText()},this.save=function(){a.saved=!0,b.publishText().then(function(){d(function(){a.saved=!1},1e3)})}}]),angular.module("angularCmsBlox").directive("cmsText",[function(){return{restrict:"EA",replace:!1,scope:{key:"@cmsText"},templateUrl:"cms/cms-text.template.html",controller:"cmsTextController",controllerAs:"ctrl",bindToController:!0}}]).controller("cmsTextController",["$translate","$scope","authService","cmsService",function(a,b,c,d){b.key=this.key,a(this.key).then(function(a){b.text=a,b.cols=b.text.length>100?100:b.text.length,b.rows=Math.ceil(b.text.length/b.cols)+1}),this.save=function(){d.savePageText(b.key,b.text)},this.isAuthenticated=function(){return c.isAuthenticated()}}]),angular.module("angularCmsBlox").run(["editableOptions",function(a){a.theme="bs3"}]),angular.module("angularCmsBlox").factory("cmsService",["$resource","$q","$translate","$window","cmsConfig",function(a,b,c,d,e){var f,g,h=a(e.url+"/:id",{id:"@id"}),i=function(a,b,c){var d=a.split("."),e=d.length-1,f=c;d.some(function(a,c){if("undefined"==typeof a)return!0;if(c===e)f[a]=b;else{var d=f[a]||{};f[a]=d,f=d}})},j=function(a,c){var d=b.defer(),e=a+"."+c;return h.get({id:e},function(a){d.resolve(a)},function(a){d.reject(a.status)}),d.promise},k=function(a,b){var d=a.split(".")[0];g=c.preferredLanguage(),j(d,g).then(function(c){i(a,b,c),f=c})},l=function(){var a=b.defer();return h.save(f,function(){c.refresh(g),a.resolve()}),a.promise},m=function(){c.refresh(g),d.location.reload()};return{getPageText:j,savePageText:k,publishText:l,undoText:m}}]),angular.module("angularCmsBlox").provider("cmsConfig",["$translateProvider","$translatePartialLoaderProvider","$authProvider",function(a,b,c){c.withCredentials=!1,a.useLoaderCache(!0),this.loginPath="/login",this.setLoginPath=function(a){this.loginPath=a},this.setPreferredLanguage=function(b){this.preferredLanguage=b||"nl_NL",a.preferredLanguage(this.preferredLanguage)},this.setCmsUrl=function(b){this.url=b||"/api/example/cms",a.useLoader("$translatePartialLoader",{urlTemplate:this.url+"/{part}.{lang}"})},this.setEmailConfig=function(a){c.loginUrl=a.loginUrl||"/auth/login",c.signupUrl=a.signupUrl||"/auth/signup"},this.setGoogleConfig=function(a){c.google(a||{clientId:"402827681397-4bud9sjicgcshr9i5d6b1u9rmqccp3km.apps.googleusercontent.com",url:"http://localhost:3000/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin||window.location.protocol+"//"+window.location.host,scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:580,height:400}})},this.setProfileUrl=function(a){this.profileUrl=a||"/auth/me"},this.addCmsText=function(a){b.addPart(a)},this.$get=function(){return this}}]);