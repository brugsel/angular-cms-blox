"use strict";angular.module("angularCmsBlox",["ngResource","ngCookies","ngAnimate","ngMaterial","ngMessages","satellizer","pascalprecht.translate","xeditable","angular-inview"]),angular.module("angularCmsBlox").run(["$templateCache",function(a){a.put("auth/auth-buttons.template.html",'<span>\n    <md-button class="auth-buttons" ng-click="ctrl.action()" >{{ctrl.label.key | translate}}</md-button>\n</span>'),a.put("auth/login.template.html",'<div class="auth-login">\n\n    <div ng-hide="ctrl.isAuthenticated()">\n\n        <div layout="row">\n            <div flex="30"></div>\n            <div flex>\n                <h2 cms-text="auth.title"></h2>\n                <md-button layout-fill class="md-primary md-raised" ng-click="ctrl.authenticate(\'google\')">\n                    <i class="fa fa-google"></i> Google\n                </md-button>\n                <div class="signup-or-separator">\n                    <h6 class="text" cms-text="auth.or"></h6>\n                    <hr>\n                </div>\n\n                <form name="loginForm">\n\n                    <md-input-container>\n                        <label>{{\'auth.email\' | translate}}</label>\n                        <input type="email" name="email" ng-model="ctrl.login.email" required>\n                        <div ng-messages="loginForm.email.$error" ng-show="loginForm.email.$dirty && loginForm.email.$invalid">\n                            <div ng-message="required">This is required!</div>\n                            <div ng-message="email">That\'s not an e-mail!</div>\n                        </div>\n                    </md-input-container>\n                    <md-input-container>\n                      <label>{{\'auth.password\' | translate}}</label>\n                      <input type="password" name="password" ng-model="ctrl.login.password" required md-maxlength="50" minlength="4">\n                        <div ng-messages="loginForm.password.$error" ng-show="loginForm.password.$dirty && loginForm.password.$invalid">\n                            <div ng-message="required">This is required!</div>\n                            <div ng-message="md-maxlength">That\'s too long!</div>\n                            <div ng-message="minlength">That\'s too short!</div>\n                        </div>\n                    </md-input-container>\n                    <md-input-container ng-hide="ctrl.isLogin" class="animate">\n                      <label>{{\'auth.password-confirm\' | translate}}</label>\n                      <input type="password" name="passwordCheck" ng-model="ctrl.login.passwordCheck" required ng-if="!ctrl.isLogin" dn-match="ctrl.login.password">\n                        <div ng-messages="loginForm.passwordCheck.$error" ng-show="loginForm.passwordCheck.$dirty && loginForm.passwordCheck.$invalid">\n                            <div ng-message="required">This is required!</div>\n                            <div ng-message="match">Password does not match!</div>\n                        </div>\n                    </md-input-container>\n\n                </form>\n               <md-button ng-show="ctrl.isLogin" class="md-raised" ng-click="ctrl.login()" aria-label="login" ng-disabled="!loginForm.$valid">\n                    <span cms-text="auth.login"></span>\n                </md-button>\n                <md-button ng-hide="ctrl.isLogin" class="md-raised" ng-click="ctrl.signup()" aria-label="signup" ng-disabled="!loginForm.$valid">\n                    <span cms-text="auth.signup"></span>\n                </md-button>\n                <div layout="row">\n                    <div flex="50" layout-align="left">\n                        <md-button class="pull-left" ng-click="ctrl.switchSignup()" aria-label="goto signup">\n                            <span ng-show="ctrl.isLogin" cms-text="auth.to-signup"></span>\n                            <span ng-hide="ctrl.isLogin" cms-text="auth.to-login"></span>\n                        </md-button>\n                    </div>\n                    <div flex="50" layout-align="right">\n                        <md-button class="pull-right" onclick="alert(\'Not implemented yet!\')" aria-label="password lost">\n                            <span cms-text="auth.lost"></span>\n                        </md-button>\n                    </div>\n                </div>\n\n            </div>\n            <div flex="30"></div>\n        </div>\n\n    <div ng-show="ctrl.isAuthenticated()">\n\n        <div layout="row">\n            <div flex="30"></div>\n            <div flex>\n                <h2>Logout</h2>\n                <div layout="row">\n                    <div flex="50" layout-align="left">\n                        <md-button class="md-raised" ng-click="ctrl.logout()">\n                            Logout\n                        </md-button>\n                    </div>\n                    <div flex="50" layout-align="right">\n                        <md-button class="md-raised" ng-click="ctrl.cancel()">\n                            Cancel\n                        </md-button>\n                    </div>\n                </div>\n            </div>\n            <div flex="30"></div>\n        </div>\n\n    </div>\n</div>\n'),a.put("cms/cms-control-panel.template.html",'<div class="cms-control-panel" ng-show="ctrl.isAuthenticated()">\n\n    <div class="panel-button"><i class="fa fa-2x fa-cog" ng-click="ctrl.showPanel()"></i></div>\n\n    <div class="panel-widget" ng-show="ctrl.panel">\n        <i class="fa fa-2x fa-edit" ng-click="ctrl.toggleEditMode()" ng-hide="ctrl.isEditable()"></i>\n        <i class="fa fa-2x fa-stop" ng-click="ctrl.toggleEditMode()" ng-show="ctrl.isEditable()"></i>\n        <i class="fa fa-2x fa-save" ng-click="ctrl.save()" ng-hide="ctrl.status.saved"></i>\n        <i class="fa fa-2x fa-ellipsis-h" ng-show="ctrl.status.saved"></i>\n        <i class="fa fa-2x fa-undo" ng-click="ctrl.undo()"></i>\n    </div>\n\n</div>\n'),a.put("cms/cms-text.template.html",'<span translate-cloak editable-textarea="ctrl.item.text" onaftersave="ctrl.save()" e-form="textBtnForm" e-rows="{{ctrl.item.rows}}" e-cols="{{ctrl.item.cols}}">\n  {{ctrl.item.text}} <i class="fa fa-edit" ng-if="ctrl.isEditable()" class="btn btn-sm" ng-click="textBtnForm.$show()" ng-hide="textBtnForm.$visible"></i>\n</span>\n'),a.put("landing/landing-default.template.html",'<div class="landing-default full-width" layout="row" layout-align="center center" layout-fill>\n  <div ng-transclude></div>\n</div>\n'),a.put("landing/landing-title.template.html",'<div class="landing-title" layout="row" layout-align="center center" layout-fill>\n    <div class="full-width" in-view="ctrl.startLoop()">\n\n        <div ng-switch on="ctrl.settings.index">\n            <h1 class="animate-switch" ng-switch-when="0" translate="{{ctrl.settings.texts[ctrl.settings.index]}}"></h1>\n            <h1 class="animate-switch" ng-switch-when="1" translate="{{ctrl.settings.texts[ctrl.settings.index]}}"></h1>\n            <h1 class="animate-switch" ng-switch-when="2" translate="{{ctrl.settings.texts[ctrl.settings.index]}}"></h1>\n        </div>\n\n        <div ng-show="ctrl.isEditable()">\n\n          <div ng-repeat="text in ctrl.settings.texts">\n            <span cms-text="{{text}}"></span><br>\n          </div>\n\n        </div>\n\n    </div>\n</div>\n')}]),angular.module("angularCmsBlox").directive("authButtons",[function(){return{restrict:"EA",replace:!0,templateUrl:"auth/auth-buttons.template.html",controller:["authService","cmsConfig","$location","$rootScope",function(a,b,c,d){this.isAuthenticated=function(){return a.isAuthenticated()},this.label={key:a.isAuthenticated()?"auth.logout":"auth.login"},this.action=function(){a.isAuthenticated()?a.logout():c.path(b.loginPath)};var e=this.label;d.$on("auth:login",function(){e.key="auth.logout"}),d.$on("auth:logout",function(){e.key="auth.login"})}],controllerAs:"ctrl",bindToController:!0}}]),angular.module("angularCmsBlox").directive("dnMatch",[function(){return{require:"ngModel",restrict:"A",link:function(a,b,c,d){var e=b.attr("dn-match");d.$validators.match=function(b,c){return c===a.$eval(e)}}}}]),angular.module("angularCmsBlox").config([function(){}]),angular.module("angularCmsBlox").factory("authService",["$log","$resource","$auth","cmsConfig","$rootScope","$q",function(a,b,c,d,e,f){var g,h,i=b(d.profileUrl),j=function(a,b){i.get(function(c){g=c,b(g.role>=a?!0:!1)})},k=function(){return c.isAuthenticated()},l=function(){c.logout(),e.$emit("auth:logout")},m=function(b,d){c.login({email:b,password:d}).then(function(b){a.debug(b),e.$emit("auth:login")},function(b){a.debug(b)})},n=function(b,d){c.signup({email:b,password:d}).then(function(b){a.debug(b.data)})},o=function(a){var b=f.defer();return c.authenticate(a).then(function(a){console.log(a),e.$emit("auth:login"),b.resolve()},function(a){console.log(a)}),b.promise};return{isAuthorized:j,isAuthenticated:k,logout:l,login:m,signup:n,authenticate:o,getPath:function(){return h},setPath:function(a){h=a}}}]),angular.module("angularCmsBlox").constant("ACCESS_LEVELS",{pub:0,one:1,two:2,three:4,four:8,five:16}).config(function(a){var b=function(a,b){return{response:function(a){return a},responseError:function(c){switch(c.status){case 401:b.$broadcast("auth:loginRequired");break;case 403:b.$broadcast("auth:forbidden");break;case 404:b.$broadcast("page:notFound");break;case 500:b.$broadcast("server:error")}return a.reject(c)}}};a.interceptors.push(b)}).run(["$rootScope","$location","authService","ACCESS_LEVELS",function(a,b,c,d){a.$on("$stateChangeStart",function(a,e){e.accessLevel>d.pub&&(c.isAuthenticated()?c.isAuthorized(e.accessLevel,function(a){a||b.path("/")}):(c.setPath(b.path()),b.path("/login")))}),a.$on("auth:loginRequired",function(){c.setPath(b.path()),b.path("/login")})}]),angular.module("angularCmsBlox").directive("authLogin",["$location","authService",function(a,b){return{restrict:"EA",replace:!0,scope:{},templateUrl:"auth/login.template.html",controller:[function(){this.loginForm={},this.isLogin=!0,this.authenticate=function(c){b.authenticate(c).then(function(){b.getPath()&&a.path(b.getPath())})},this.isAuthenticated=function(){return b.isAuthenticated()},this.login=function(){b.login(this.login.email,this.login.password)},this.logout=function(){b.logout()},this.signup=function(){b.signup(this.login.email,this.login.password)},this.cancel=function(){a.path(b.getPath()?b.getPath():"/")},this.switchSignup=function(){this.isLogin=!this.isLogin}}],controllerAs:"ctrl",bindToController:!0}}]),angular.module("angularCmsBlox").directive("cmsControlPanel",[function(){return{restrict:"EA",replace:!1,scope:{},templateUrl:"cms/cms-control-panel.template.html",controller:"cmsControlPanelController",controllerAs:"ctrl",bindToController:!0}}]).controller("cmsControlPanelController",["cmsService","authService","$timeout",function(a,b,c){var d={saved:!1};this.status=d,this.panel=!1,this.showPanel=function(){this.panel=!this.panel},this.isAuthenticated=function(){return b.isAuthenticated()},this.undo=function(){a.undoText()},this.save=function(){d.saved=!0,a.publishText().then(function(){c(function(){d.saved=!1},1e3)})},this.toggleEditMode=function(){a.toggleEditMode()},this.isEditable=function(){return a.isEditable()}}]),angular.module("angularCmsBlox").directive("cmsText",[function(){return{restrict:"EA",replace:!1,scope:{key:"@cmsText"},templateUrl:"cms/cms-text.template.html",controller:"cmsTextController",controllerAs:"ctrl",bindToController:!0}}]).controller("cmsTextController",["$translate","cmsService",function(a,b){var c={key:this.key};this.item=c,a(this.key).then(function(a){c.text=a,c.cols=c.text.length>100?100:c.text.length,c.rows=Math.ceil(c.text.length/c.cols)+1}),this.save=function(){b.savePageText(c.key,c.text)},this.isEditable=function(){return b.isEditable()}}]),angular.module("angularCmsBlox").run(["editableOptions","editableThemes",function(a,b){a.theme="default",b["default"].submitTpl='<md-button class="md-raised" type="submit"><i class="fa fa-check"></i></md-button>',b["default"].cancelTpl='<md-button class="md-raised" type="button" ng-click="$form.$cancel()" tabindex="0"><i class="fa fa-remove"></i></md-button>'}]),angular.module("angularCmsBlox").factory("cmsService",["$rootScope","$resource","$q","$translate","$window","cmsConfig",function(a,b,c,d,e,f){var g,h,i=b(f.url+"/:id",{id:"@id"}),j=!1,k=function(a,b,c){var d=a.split("."),e=d.length-1,f=c;d.some(function(a,c){if("undefined"==typeof a)return!0;if(c===e)f[a]=b;else{var d=f[a]||{};f[a]=d,f=d}})},l=function(a,b){var d=c.defer(),e=a+"."+b;return i.get({id:e},function(a){d.resolve(a)},function(a){d.reject(a.status)}),d.promise},m=function(b,c){var e=b.split(".")[0];h=d.preferredLanguage(),l(e,h).then(function(d){k(b,c,d),g=d,a.$emit("cms:savePageText")})},n=function(){var b=c.defer();return i.save(g,function(){d.refresh(h),a.$emit("cms:publishText"),b.resolve()}),b.promise},o=function(){d.refresh(h),e.location.reload()},p=function(){j=!j},q=function(){return j};return{getPageText:l,savePageText:m,publishText:n,undoText:o,toggleEditMode:p,isEditable:q}}]),angular.module("angularCmsBlox").provider("cmsConfig",["$translateProvider","$translatePartialLoaderProvider","$authProvider",function(a,b,c){c.withCredentials=!1,a.useLoaderCache(!0),this.loginPath="/login",this.setLoginPath=function(a){this.loginPath=a},this.setPreferredLanguage=function(b){this.preferredLanguage=b||"nl_NL",a.preferredLanguage(this.preferredLanguage)},this.setCmsUrl=function(b){this.url=b||"/api/example/cms",a.useLoader("$translatePartialLoader",{urlTemplate:this.url+"/{part}.{lang}"})},this.setEmailConfig=function(a){c.loginUrl=a.loginUrl||"/auth/login",c.signupUrl=a.signupUrl||"/auth/signup"},this.setGoogleConfig=function(a){c.google(a||{clientId:"402827681397-4bud9sjicgcshr9i5d6b1u9rmqccp3km.apps.googleusercontent.com",url:"http://localhost:3000/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:window.location.origin||window.location.protocol+"//"+window.location.host,scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",requiredUrlParams:["scope"],optionalUrlParams:["display"],display:"popup",type:"2.0",popupOptions:{width:580,height:400}})},this.setProfileUrl=function(a){this.profileUrl=a||"/auth/me"},this.addCmsText=function(a){b.addPart(a)},this.$get=function(){return this}}]),angular.module("angularCmsBlox").factory("configService",["$resource","$q",function(a,b){var c,d=function(d){var e=b.defer();if(c)e.resolve(c);else{var f=a(d);f.get({},function(a){c=a,e.resolve(c)},function(a){e.reject(a.status)})}return e.promise};return{getConfig:d}}]),angular.module("angularCmsBlox").directive("cmsLandingDefault",[function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"landing/landing-default.template.html"}}]),angular.module("angularCmsBlox").directive("cmsLandingParallax",["$window",function(a){return{restrict:"A",transclude:!0,template:"<div ng-transclude></div>",scope:{ratio:"=",offset:"="},controllerAs:"ctrl",bindToController:!0,link:function(b,c){function d(){var d=(c.prop("offsetTop")-a.pageYOffset)*(b.ratio?b.ratio:1.1)+(b.offset?b.offset:0);c.css("background-position","50% "+d+"px")}d(),angular.element(a).bind("scroll",d),angular.element(a).bind("touchmove",d)}}}]),angular.module("angularCmsBlox").directive("cmsLandingTitle",[function(){return{restrict:"EA",replace:!1,scope:{text:"@",duration:"@"},templateUrl:"landing/landing-title.template.html",controller:"landingTitleController",controllerAs:"ctrl",bindToController:!0}}]).controller("landingTitleController",["$rootScope","$log","$timeout","cmsService",function(a,b,c,d){var e=this.text.split(" "),f=this.duration||3e3,g=function(){c(function(){h.next=h.index+1,h.index=void 0,c(function(){h.index=h.next,h.index>h.texts.length&&(h.index=0),g()},1e3)},f)},h={index:void 0,texts:[]};this.settings=h,this.startLoop=function(){h.texts=e,c(function(){h.index=0,g()},250)},this.isEditable=function(){return d.isEditable()}}]),angular.module("angularCmsBlox").run(["editableOptions",function(){}]);